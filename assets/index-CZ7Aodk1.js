(function(){const l=document.createElement("link").relList;if(l&&l.supports&&l.supports("modulepreload"))return;for(const i of document.querySelectorAll('link[rel="modulepreload"]'))a(i);new MutationObserver(i=>{for(const n of i)if(n.type==="childList")for(const I of n.addedNodes)I.tagName==="LINK"&&I.rel==="modulepreload"&&a(I)}).observe(document,{childList:!0,subtree:!0});function r(i){const n={};return i.integrity&&(n.integrity=i.integrity),i.referrerPolicy&&(n.referrerPolicy=i.referrerPolicy),i.crossOrigin==="use-credentials"?n.credentials="include":i.crossOrigin==="anonymous"?n.credentials="omit":n.credentials="same-origin",n}function a(i){if(i.ep)return;i.ep=!0;const n=r(i);fetch(i.href,n)}})();const s=document.getElementById("gameCanvas"),o=s.getContext("2d"),J=.5,N=4,d=400,x=3200;let c=0;const v=[],M=[],S=[],t={x:100,y:d-50,width:40,height:50,vx:0,vy:0,onGround:!1},w=[],B=[];function O(){let e=0;const l=[];for(;e<x;){const i=Math.random()<.2?320:160+Math.random()*160;let n;if(Math.random()<.25){const K=(Math.random()<.5?1:-1)*(20+Math.random()*20);n={x:e,y:d,width:i,height:50,endY:d+K,isSlope:!0}}else n={x:e,y:d,width:i,height:50};w.push(n),l.push({x:e+i/2,y:d-30}),Math.random()<.5&&v.push({x:e+i/2-10,y:d-30,width:20,height:20,collected:!1,type:"coin"}),Math.random()<.3&&e>0&&M.push({x:e-40,y:d+35,width:40,height:15}),Math.random()<.2&&e>0&&S.push({x:e-60,y:d-100,width:80,height:20,dx:2,range:120,startX:e-60}),e+=i;const I=60+Math.random()*80;e+=I,Math.random()<.5&&e<x-50&&B.push({x:e+10,y:d-40,width:40,height:40})}if(l.length>0){const i=Math.floor(Math.random()*l.length),n=l[i];v.push({x:n.x-10,y:n.y,width:20,height:20,collected:!1,type:"heart"})}const r=100;w.some(i=>i.x<=r&&i.x+i.width>=r+40)||w.unshift({x:60,y:d,width:80,height:50})}O();function A(e,l){return e.x<l.x+l.width&&e.x+e.width>l.x&&e.y<l.y+l.height&&e.y+e.height>l.y}let y=0,D=1,W=x-100,L=0,b=3,P=!1,E=Number(localStorage.getItem("topScore")||"0");function X(e){e>E&&(E=e,localStorage.setItem("topScore",String(E)))}function j(){y=0,D=1,b=3,P=!1,w.length=0,B.length=0,v.length=0,M.length=0,S.length=0,O(),z()}function z(){t.x=100,t.y=d-50,t.vx=0,t.vy=0}function Y(){if(b--,b<=0){X(y),P=!0,U();return}z(),L=30}function U(){let e=document.getElementById("restart-btn");e?e&&(e.style.display="block"):(e=document.createElement("button"),e.id="restart-btn",e.textContent="Restart",e.style.position="fixed",e.style.left="50%",e.style.top="50%",e.style.transform="translate(-50%, -50%)",e.style.fontSize="2em",e.style.padding="16px 32px",e.style.zIndex="100",e.style.background="#222",e.style.color="#fff",e.style.border="2px solid #0cf",e.style.borderRadius="12px",e.style.cursor="pointer",e.onclick=()=>{e?.remove(),j()},document.body.appendChild(e))}function q(){const e=document.getElementById("restart-btn");e&&(e.style.display="none")}function V(){w.length=0,B.length=0,v.length=0,M.length=0,S.length=0,O(),z(),y=0,D++}function F(){if(!P){if(L>0){L--;return}t.vx=0,(h.ArrowLeft||h.KeyA)&&(t.vx=-N),(h.ArrowRight||h.KeyD)&&(t.vx=N),(h.ArrowUp||h.Space||h.KeyW)&&t.onGround&&(t.vy=-12,t.onGround=!1),t.vy+=J,t.x+=t.vx,t.y+=t.vy,t.onGround=!1;for(const e of w)if("isSlope"in e&&e.isSlope){if(t.x+t.width>e.x&&t.x<e.x+e.width){const l=(t.x+t.width/2-e.x)/e.width,r=e.y+(e.endY-e.y)*l;t.y+t.height>r&&t.y+t.height<r+e.height&&t.vy>=0&&(t.y=r-t.height,t.vy=0,t.onGround=!0)}}else t.y+t.height>e.y&&t.y+t.height<e.y+e.height&&t.x+t.width>e.x&&t.x<e.x+e.width&&t.vy>=0&&(t.y=e.y-t.height,t.vy=0,t.onGround=!0);for(const e of B)A(t,e)&&(t.y+t.height-t.vy<=e.y?(t.y=e.y-t.height,t.vy=0,t.onGround=!0):t.x+t.width-t.vx<=e.x?t.x=e.x-t.width:t.x-t.vx>=e.x+e.width?t.x=e.x+e.width:t.y-t.vy>=e.y+e.height&&(t.y=e.y+e.height,t.vy=0));for(const e of S)e.x+=e.dx,(e.x>e.startX+e.range||e.x<e.startX)&&(e.dx*=-1);for(const e of S)t.y+t.height>e.y&&t.y+t.height<e.y+e.height&&t.x+t.width>e.x&&t.x<e.x+e.width&&t.vy>=0&&(t.y=e.y-t.height,t.vy=0,t.onGround=!0,t.x+=e.dx);for(const e of v)!e.collected&&A(t,e)&&(e.collected=!0,e.type==="coin"?(y++,X(y)):e.type==="heart"&&b<5&&b++);for(const e of M)if(A(t,e)){Y();break}t.y>s.height+100&&Y(),t.x+t.width>=W&&V(),c=t.x-s.width/2+t.width/2,c=Math.max(0,Math.min(c,x-s.width)),t.x<0&&(t.x=0),t.x+t.width>x&&(t.x=x-t.width)}}let m=localStorage.getItem("fixedGradient")==="true",p=localStorage.getItem("scrollGradient")==="true",G=JSON.parse(localStorage.getItem("fixedGradientColors")||"null")||k(),C=JSON.parse(localStorage.getItem("scrollGradientColors")||"null")||k(),f=localStorage.getItem("imageBg")==="true",u=localStorage.getItem("imageBgUrl")||null,g=null,T=!1;function H(){fetch("https://pixabay.com/api/?key=51252753-0f1aa9c83b326091b3ad96f88&q=landscape&image_type=photo&orientation=horizontal&safesearch=true&per_page=50").then(r=>r.json()).then(r=>{if(r.hits&&r.hits.length>0){const a=Math.floor(Math.random()*r.hits.length);u=r.hits[a].largeImageURL,u&&(localStorage.setItem("imageBgUrl",u),_())}}).catch(()=>{u=null,T=!1})}function _(){u&&(g=new window.Image,g.crossOrigin="anonymous",g.onload=()=>{T=!0},g.onerror=()=>{T=!1},g.src=u)}u&&_();function k(){function e(){return`hsl(${Math.floor(Math.random()*360)}, 70%, 75%)`}return[e(),e()]}function R(){localStorage.setItem("fixedGradient",String(m)),localStorage.setItem("scrollGradient",String(p)),localStorage.setItem("imageBg",String(f)),localStorage.setItem("fixedGradientColors",JSON.stringify(G)),localStorage.setItem("scrollGradientColors",JSON.stringify(C)),f||(localStorage.removeItem("imageBgUrl"),u=null,g=null,T=!1)}window.addEventListener("DOMContentLoaded",()=>{const e=document.getElementById("settings-btn"),l=document.getElementById("settings-modal"),r=document.getElementById("close-settings"),a=document.getElementById("fixed-gradient-toggle"),i=document.getElementById("scroll-gradient-toggle"),n=document.getElementById("image-bg-toggle");e&&l&&r&&a&&i&&n&&(e.addEventListener("click",()=>{l.style.display="flex",a.checked=m,i.checked=p,n.checked=f}),r.addEventListener("click",()=>{l.style.display="none"}),a.addEventListener("change",()=>{a.checked?(m=!0,p=!1,f=!1,i.checked=!1,n.checked=!1,G=k()):m=!1,R()}),i.addEventListener("change",()=>{i.checked?(p=!0,m=!1,f=!1,a.checked=!1,n.checked=!1,C=k()):p=!1,R()}),n.addEventListener("change",()=>{n.checked?(f=!0,m=!1,p=!1,a.checked=!1,i.checked=!1,H()):f=!1,R()}))});function Q(){if(f&&T&&g){const e=g,l=Math.max(s.width/e.width,s.height/e.height),r=e.width*l,a=e.height*l;let i=-c%r;i>0&&(i-=r);for(let n=i;n<s.width;n+=r)o.drawImage(e,n,0,r,a)}else if(m){const e=o.createLinearGradient(0,0,0,s.height);e.addColorStop(0,G[0]),e.addColorStop(1,G[1]),o.fillStyle=e,o.fillRect(0,0,s.width,s.height)}else if(p){const e=o.createLinearGradient(-c,0,x-c,s.height);e.addColorStop(0,C[0]),e.addColorStop(1,C[1]),o.fillStyle=e,o.fillRect(0,0,s.width,s.height)}else o.fillStyle="#87ceeb",o.fillRect(0,0,s.width,s.height);o.save(),o.translate(-c,0),o.fillStyle="#654321";for(const e of w)"isSlope"in e&&e.isSlope?(o.beginPath(),o.moveTo(e.x,e.y),o.lineTo(e.x+e.width,e.endY),o.lineTo(e.x+e.width,e.endY+e.height),o.lineTo(e.x,e.y+e.height),o.closePath(),o.fill()):o.fillRect(e.x,e.y,e.width,e.height);o.fillStyle="#888";for(const e of S)o.fillRect(e.x,e.y,e.width,e.height);o.fillStyle="#b5651d";for(const e of B)o.fillRect(e.x,e.y,e.width,e.height);for(const e of v)e.collected||(e.type==="coin"?(o.fillStyle="#0cf",o.beginPath(),o.arc(e.x+e.width/2,e.y+e.height/2,10,0,2*Math.PI),o.fill()):e.type==="heart"&&(o.save(),o.translate(e.x+e.width/2,e.y+e.height/2),o.scale(1.2,1.2),o.beginPath(),o.moveTo(0,6),o.bezierCurveTo(0,0,-10,0,-10,6),o.bezierCurveTo(-10,12,0,16,0,20),o.bezierCurveTo(0,16,10,12,10,6),o.bezierCurveTo(10,0,0,0,0,6),o.closePath(),o.fillStyle="#e33",o.fill(),o.restore()));o.fillStyle="#e33";for(const e of M)o.beginPath(),o.moveTo(e.x,e.y+e.height),o.lineTo(e.x+e.width/2,e.y),o.lineTo(e.x+e.width,e.y+e.height),o.closePath(),o.fill();o.restore(),L>0&&Math.floor(L/5)%2===0?o.globalAlpha=.3:o.globalAlpha=1,o.fillStyle="#ff0",o.fillRect(t.x-c,t.y,t.width,t.height),o.globalAlpha=1,o.save(),o.fillStyle="#fff",o.font="20px sans-serif",o.textAlign="left",o.fillText(`Score: ${y}`,20,30),o.fillText(`Top Score: ${E}`,20,60),o.fillText(`Level: ${D}`,20,90);for(let e=0;e<b;e++)o.save(),o.translate(20+e*28,120),o.scale(1.2,1.2),o.beginPath(),o.moveTo(0,6),o.bezierCurveTo(0,0,-10,0,-10,6),o.bezierCurveTo(-10,12,0,16,0,20),o.bezierCurveTo(0,16,10,12,10,6),o.bezierCurveTo(10,0,0,0,0,6),o.closePath(),o.fillStyle="#e33",o.fill(),o.restore();o.restore(),P?(o.save(),o.font="bold 48px sans-serif",o.fillStyle="#e33",o.textAlign="center",o.fillText("Game Over",s.width/2,s.height/2-60),o.font="32px sans-serif",o.fillStyle="#fff",o.fillText(`Score: ${y}`,s.width/2,s.height/2-10),o.fillText(`Top Score: ${E}`,s.width/2,s.height/2+40),y>Number(localStorage.getItem("topScore")||"0")&&(o.font="bold 28px sans-serif",o.fillStyle="#0cf",o.fillText("You beat your own top score!",s.width/2,s.height/2+90)),o.restore(),U()):q()}function $(){F(),Q(),requestAnimationFrame($)}const h={};window.addEventListener("keydown",e=>{h[e.code]=!0});window.addEventListener("keyup",e=>{h[e.code]=!1});function Z(){if(!/Android|iPhone|iPad|iPod|Opera Mini|IEMobile|WPDesktop/i.test(navigator.userAgent))return;const l=document.getElementById("btn-left"),r=document.getElementById("btn-right"),a=document.getElementById("btn-jump");l&&r&&a&&(l.addEventListener("touchstart",i=>{i.preventDefault(),h.ArrowLeft=!0}),l.addEventListener("touchend",i=>{i.preventDefault(),h.ArrowLeft=!1}),r.addEventListener("touchstart",i=>{i.preventDefault(),h.ArrowRight=!0}),r.addEventListener("touchend",i=>{i.preventDefault(),h.ArrowRight=!1}),a.addEventListener("touchstart",i=>{i.preventDefault(),h.Space=!0}),a.addEventListener("touchend",i=>{i.preventDefault(),h.Space=!1}))}Z();$();
