(function(){const i=document.createElement("link").relList;if(i&&i.supports&&i.supports("modulepreload"))return;for(const r of document.querySelectorAll('link[rel="modulepreload"]'))e(r);new MutationObserver(r=>{for(const s of r)if(s.type==="childList")for(const f of s.addedNodes)f.tagName==="LINK"&&f.rel==="modulepreload"&&e(f)}).observe(document,{childList:!0,subtree:!0});function n(r){const s={};return r.integrity&&(s.integrity=r.integrity),r.referrerPolicy&&(s.referrerPolicy=r.referrerPolicy),r.crossOrigin==="use-credentials"?s.credentials="include":r.crossOrigin==="anonymous"?s.credentials="omit":s.credentials="same-origin",s}function e(r){if(r.ep)return;r.ep=!0;const s=n(r);fetch(r.href,s)}})();class xe{constructor(){this.ws=null,this.isConnected=!1,this.isHost=!1,this.reconnectAttempts=0,this.maxReconnectAttempts=3,this.reconnectDelay=1e3,this.playerId=this.generatePlayerId()}generatePlayerId(){return"player_"+Math.random().toString(36).substr(2,9)}async checkServerAvailable(i=this.getDefaultServerUrl()){try{if(i==="/ws")return(await fetch("/mp/health",{method:"GET",signal:AbortSignal.timeout(2e3)})).ok;const n=i.replace("ws://","http://").replace("wss://","https://");let e;return n.includes("/ws")?e=n.replace("/ws","/mp/health"):e=`${n}/health`,(await fetch(e,{method:"GET",signal:AbortSignal.timeout(2e3)})).ok}catch{return console.log("Multiplayer server not available, running in single-player mode"),!1}}getDefaultServerUrl(){const i=window.location.protocol==="https:"?"wss:":"ws:",n=window.location.host,e=window.location.hostname;if(e.includes(".onrender.com")||!n.includes("localhost"))return"/ws";if(n.includes("localhost:5173")||n.includes("127.0.0.1:5173"))return"ws://localhost:3001";if(n.includes(":8080")||e==="localhost"&&n.includes(":80")){const r=n.split(":")[0];return`${i}//${r}:3001`}return`${i}//${n}:3001`}async initialize(i=this.getDefaultServerUrl()){try{return await this.checkServerAvailable(i)?(this.ws=new WebSocket(i),new Promise(e=>{if(!this.ws){e(!1);return}const r=setTimeout(()=>{console.log("Connection timeout, falling back to single-player mode"),this.disconnect(),e(!1)},5e3);this.ws.onopen=()=>{clearTimeout(r),this.isConnected=!0,this.reconnectAttempts=0,console.log("Connected to multiplayer server");let s="";try{s=localStorage.getItem("playerName")||""}catch{}this.send({type:"join",playerId:this.playerId,name:s,timestamp:Date.now()}),e(!0)},this.ws.onmessage=s=>{try{const f=JSON.parse(s.data);this.handleMessage(f)}catch(f){console.error("Error parsing message:",f)}},this.ws.onclose=()=>{this.isConnected=!1,console.log("Disconnected from multiplayer server"),this.attemptReconnect(i)},this.ws.onerror=s=>{clearTimeout(r),console.log("WebSocket error, falling back to single-player mode"),this.isConnected=!1,e(!1)}})):(console.log("Multiplayer server not available, continuing in single-player mode"),!1)}catch{return console.log("Failed to initialize multiplayer, continuing in single-player mode"),!1}}attemptReconnect(i){this.reconnectAttempts<this.maxReconnectAttempts?(this.reconnectAttempts++,console.log(`Attempting to reconnect (${this.reconnectAttempts}/${this.maxReconnectAttempts})...`),setTimeout(()=>{this.initialize(i)},this.reconnectDelay*this.reconnectAttempts)):console.log("Max reconnection attempts reached, continuing in single-player mode")}handleMessage(i){switch(i.type){case"gameState":this.onStateUpdate&&this.onStateUpdate(i.gameState);break;case"playerJoined":i.playerId===this.playerId&&(this.isHost=i.isHost||!1),this.onPlayerJoin&&this.onPlayerJoin(i.playerId);break;case"playerLeft":this.onPlayerLeave&&this.onPlayerLeave(i.playerId);break;case"playerUpdate":this._onPlayerUpdate&&this._onPlayerUpdate(i.playerId,i.position,i.score,i.name);break;case"itemCollected":this._onPlayerUpdate&&this._onPlayerUpdate(i.playerId,{},i.score,i.name);break}}send(i){if(this.ws&&this.isConnected)try{this.ws.send(JSON.stringify(i))}catch(n){console.error("Error sending message:",n),this.isConnected=!1}}updatePlayerPosition(i,n,e,r,s){this.isConnected&&this.send({type:"playerUpdate",playerId:this.playerId,position:{x:i,y:n,width:e,height:r,growLevel:s},timestamp:Date.now()})}collectItem(i){this.isConnected&&this.send({type:"collectItem",playerId:this.playerId,collectibleId:i,timestamp:Date.now()})}onGameStateUpdate(i){this.onStateUpdate=i}onPlayerJoined(i){this.onPlayerJoin=i}onPlayerLeft(i){this.onPlayerLeave=i}onPlayerUpdate(i){this._onPlayerUpdate=i}get connected(){return this.isConnected}get currentPlayerId(){return this.playerId}get isHostPlayer(){return this.isHost}disconnect(){this.ws&&(this.ws.close(),this.ws=null),this.isConnected=!1}ping(){this.isConnected&&this.send({type:"ping",timestamp:Date.now()})}}const x=new xe,c=document.getElementById("gameCanvas"),t=c.getContext("2d"),ve=.5,re=5,b=400,Se=60;let ae=0,ce=0,ge=0,P=localStorage.getItem("speedUnlocked")==="true",N=P?2:1,z=localStorage.getItem("showFpsCounter")!=="false";const D=3200;let u=0,be=0;function W(o){return`${o}_${Date.now()}_${be++}`}const y=[],Y=[],R=[];let p={x:0,y:0,height:80};const l={x:100,y:b-50,width:40,height:50,vx:0,vy:0,onGround:!1,hasDoubleJump:!1,growLevel:0,canDoubleJump:!1};let v=new Map,T=localStorage.getItem("multiplayerEnabled")==="true",he=0,m=localStorage.getItem("playerName")||"",I=null;const M=[],H=[];async function le(){let o=0;const i=[];for(;o<D;){const a=Math.random()<.2?320:160+Math.random()*160;let h;if(Math.random()<.25){const g=(Math.random()<.5?1:-1)*(20+Math.random()*20);h={x:o,y:b,width:a,height:50,endY:b+g,isSlope:!0}}else h={x:o,y:b,width:a,height:50};M.push(h),i.push({x:o+a/2,y:b-30}),Math.random()<.5&&y.push({x:o+a/2-10,y:b-30,width:20,height:20,collected:!1,type:"coin",id:W("coin")}),Math.random()<.3&&o>0&&Y.push({x:o-40,y:b+35,width:40,height:15}),Math.random()<.2&&o>0&&R.push({x:o-60,y:b-100,width:80,height:20,dx:2,range:120,startX:o-60}),o+=a;const w=60+Math.random()*80;o+=w,Math.random()<.5&&o<D-50&&H.push({x:o+10,y:b-40,width:40,height:40})}if(i.length>0){const a=Math.floor(Math.random()*i.length),h=i[a];y.push({x:h.x-10,y:h.y,width:20,height:20,collected:!1,type:"heart",id:W("heart")})}if(i.length>1){let a,h=0;const w=i.length*3;do a=Math.floor(Math.random()*i.length),h++;while(h<w&&y.some(g=>g.x===i[a].x-10&&g.y===i[a].y));if(h<w){const g=i[a];y.push({x:g.x-10,y:g.y-30,width:20,height:20,collected:!1,type:"doublejump",id:W("doublejump")})}}if(i.length>2){let a,h=0;const w=i.length*3;do a=Math.floor(Math.random()*i.length),h++;while(h<w&&(y.some(g=>g.x===i[a].x-10&&g.y===i[a].y)||y.some(g=>g.x===i[a].x-10&&g.y===i[a].y-30)));if(h<w){const g=i[a];y.push({x:g.x-10,y:g.y-60,width:20,height:20,collected:!1,type:"grow",id:W("grow")})}}const n=100;M.some(a=>a.x<=n&&a.x+a.width>=n+40)||M.unshift({x:60,y:b,width:80,height:50});const r=M[M.length-1];let s=r.x+r.width-32,f="isSlope"in r&&r.isSlope?r.endY-p.height:r.y-p.height;if(p.x=s,p.y=f,T&&y.length>0){const a=window.location.port==="5173"?"http://localhost:3001/register-collectibles":"/register-collectibles";try{await fetch(a,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({collectibles:y.map(h=>({id:h.id,type:h.type}))})})}catch{}}}le();function Z(o,i){return o.x<i.x+i.width&&o.x+o.width>i.x&&o.y<i.y+i.height&&o.y+o.height>i.y}let S=0,oe=1,Ie=D-100,j=0,B=3,Q=!1,_=Number(localStorage.getItem("topScore")||"0"),q=!1,V=0;function ue(o){o>_&&(_=o,localStorage.setItem("topScore",String(_)))}function Pe(){S=0,oe=1,B=3,Q=!1,M.length=0,H.length=0,y.length=0,Y.length=0,R.length=0,le(),ie()}function ie(){l.x=100,l.y=b-175,l.vx=0,l.vy=0,l.canDoubleJump=!1,ne()}function ne(){l.growLevel===0?(l.width=40,l.height=50):l.growLevel===1?(l.width=60,l.height=75):l.growLevel===2?(l.width=80,l.height=100):l.growLevel>=3&&(l.width=100,l.height=125)}function fe(){if(B--,B<=0){ue(S),Q=!0,ye();return}l.hasDoubleJump=!1,l.growLevel=0,l.canDoubleJump=!1,ne(),ie(),j=30}function ye(){let o=document.getElementById("restart-btn");o?o&&(o.style.display="block",o.style.top="calc(50% + 120px)",o.style.transform="translateX(-50%)"):(o=document.createElement("button"),o.id="restart-btn",o.textContent="Restart",o.style.position="fixed",o.style.left="50%",o.style.top="calc(50% + 120px)",o.style.transform="translateX(-50%)",o.style.fontSize="2em",o.style.padding="16px 32px",o.style.zIndex="100",o.style.background="#222",o.style.color="#fff",o.style.border="2px solid #0cf",o.style.borderRadius="12px",o.style.cursor="pointer",o.onclick=()=>{o?.remove(),Pe()},document.body.appendChild(o))}function Te(){const o=document.getElementById("restart-btn");o&&(o.style.display="none")}function Me(){M.length=0,H.length=0,y.length=0,Y.length=0,R.length=0,le(),ie(),oe++,C?(J=O(),localStorage.setItem("fixedGradientColors",JSON.stringify(J))):E?(U=O(),localStorage.setItem("scrollGradientColors",JSON.stringify(U))):L&&pe(),se(),q=!1,V=0}function Le(){se(),q=!0,V=120}function Ce(o){if(Q)return;if(q){V--,V<=0&&Me();return}if(j>0){j--;return}l.vx=0,(d.ArrowLeft||d.KeyA)&&(l.vx=-re*N*o*60),(d.ArrowRight||d.KeyD)&&(l.vx=re*N*o*60);const i=d.ArrowUp||d.Space||d.KeyW;$>0&&$--,i&&$===0&&(l.onGround?(l.vy=-13,l.onGround=!1,l.hasDoubleJump&&(l.canDoubleJump=!0),$=8):l.hasDoubleJump&&l.canDoubleJump&&(l.vy=-13,l.canDoubleJump=!1,$=8));const n=d.KeyT;n&&!de&&(P=!P,localStorage.setItem("speedUnlocked",String(P)),N=P?2:1),de=n,l.vy+=ve*o*60,l.x+=l.vx,l.y+=l.vy,l.onGround=!1;for(const e of M)if("isSlope"in e&&e.isSlope){if(l.x+l.width>e.x&&l.x<e.x+e.width){const r=(l.x+l.width/2-e.x)/e.width,s=e.y+(e.endY-e.y)*r;l.y+l.height>s&&l.y+l.height<s+e.height&&l.vy>=0&&(l.y=s-l.height,l.vy=0,l.onGround=!0,l.canDoubleJump=l.hasDoubleJump)}}else l.y+l.height>e.y&&l.y+l.height<e.y+e.height&&l.x+l.width>e.x&&l.x<e.x+e.width&&l.vy>=0&&(l.y=e.y-l.height,l.vy=0,l.onGround=!0,l.canDoubleJump=l.hasDoubleJump);for(const e of H)Z(l,e)&&(l.y+l.height-l.vy<=e.y?(l.y=e.y-l.height,l.vy=0,l.onGround=!0):l.x+l.width-l.vx<=e.x?l.x=e.x-l.width:l.x-l.vx>=e.x+e.width?l.x=e.x+e.width:l.y-l.vy>=e.y+e.height&&(l.y=e.y+e.height,l.vy=0));for(const e of R)e.x+=e.dx,(e.x>e.startX+e.range||e.x<e.startX)&&(e.dx*=-1);for(const e of R)l.y+l.height>e.y&&l.y+l.height<e.y+e.height&&l.x+l.width>e.x&&l.x<e.x+e.width&&l.vy>=0&&(l.y=e.y-l.height,l.vy=0,l.onGround=!0,l.x+=e.dx);for(const e of y)if(!e.collected&&Z(l,e)){if(e.type==="doublejump"&&l.hasDoubleJump||e.type==="grow"&&l.growLevel>=3)continue;e.collected=!0,T&&x.collectItem(e.id),e.type==="coin"?(S++,ue(S)):e.type==="heart"?B<5&&B++:e.type==="doublejump"?(l.hasDoubleJump=!0,l.canDoubleJump=!1):e.type==="grow"&&(l.growLevel<3&&l.growLevel++,ne())}for(const e of Y)if(Z(l,e)){fe();break}l.y>c.height+100&&fe(),l.x+l.width>=Ie&&!q&&Le(),u=l.x-c.width/2+l.width/2,u=Math.max(0,Math.min(u,D-c.width)),l.x<0&&(l.x=0),l.x+l.width>D&&(l.x=D-l.width),T&&Date.now()-he>50&&(x.updatePlayerPosition(l.x,l.y,l.width,l.height,l.growLevel),he=Date.now())}function Ee(){return/Tesla|QtCarBrowser/i.test(navigator.userAgent)}let K=localStorage.getItem("teslaMode")==="true";function ke(){return Ee()||K||/Android|iPhone|iPad|iPod|Opera Mini|IEMobile|WPDesktop/i.test(navigator.userAgent)}let C=localStorage.getItem("fixedGradient")==="true",E=localStorage.getItem("scrollGradient")==="true",J=JSON.parse(localStorage.getItem("fixedGradientColors")||"null")||O(),U=JSON.parse(localStorage.getItem("scrollGradientColors")||"null")||O(),L=localStorage.getItem("imageBg")==="true",A=localStorage.getItem("imageBgUrl")||null,k=null,X=!1;function pe(){fetch("https://pixabay.com/api/?key=51252753-0f1aa9c83b326091b3ad96f88&q=landscape&image_type=photo&orientation=horizontal&safesearch=true&per_page=50").then(n=>n.json()).then(n=>{if(n.hits&&n.hits.length>0){const e=Math.floor(Math.random()*n.hits.length);A=n.hits[e].largeImageURL,A&&(localStorage.setItem("imageBgUrl",A),me())}}).catch(()=>{A=null,X=!1})}function me(){A&&(k=new window.Image,k.crossOrigin="anonymous",k.onload=()=>{X=!0},k.onerror=()=>{X=!1},k.src=A)}A&&me();function O(){function o(){return`hsl(${Math.floor(Math.random()*360)}, 70%, 75%)`}return[o(),o()]}function ee(){localStorage.setItem("fixedGradient",String(C)),localStorage.setItem("scrollGradient",String(E)),localStorage.setItem("imageBg",String(L)),localStorage.setItem("fixedGradientColors",JSON.stringify(J)),localStorage.setItem("scrollGradientColors",JSON.stringify(U)),L||(localStorage.removeItem("imageBgUrl"),A=null,k=null,X=!1)}const Ae="v0.2.1-21-g9dd4751-dirty",De="9dd4751",Be="main",Ge="v0.2.1",Re="2025-07-18T14:44:03.541Z";window.addEventListener("DOMContentLoaded",()=>{const o=document.getElementById("settings-btn"),i=document.getElementById("settings-modal"),n=document.getElementById("close-settings"),e=document.getElementById("fixed-gradient-toggle"),r=document.getElementById("scroll-gradient-toggle"),s=document.getElementById("image-bg-toggle"),f=document.getElementById("speed-unlock-toggle"),a=document.getElementById("fps-counter-toggle"),h=document.getElementById("tesla-mode-toggle"),w=document.getElementById("multiplayer-toggle");I=document.getElementById("player-name-input"),o&&i&&n&&e&&r&&s&&f&&a&&h&&w&&I&&(o.addEventListener("click",()=>{i.style.display="flex",e.checked=C,r.checked=E,s.checked=L,f.checked=P,a.checked=z,h.checked=K,w.checked=T,I&&(I.value=m)}),n.addEventListener("click",()=>{i.style.display="none"}),e.addEventListener("change",()=>{e.checked?(C=!0,E=!1,L=!1,r.checked=!1,s.checked=!1,J=O()):C=!1,ee()}),r.addEventListener("change",()=>{r.checked?(E=!0,C=!1,L=!1,e.checked=!1,s.checked=!1,U=O()):E=!1,ee()}),s.addEventListener("change",()=>{s.checked?(L=!0,C=!1,E=!1,e.checked=!1,r.checked=!1,pe()):L=!1,ee()}),f.addEventListener("change",()=>{P=f.checked,localStorage.setItem("speedUnlocked",String(P)),N=P?2:1}),a.addEventListener("change",()=>{z=a.checked,localStorage.setItem("showFpsCounter",String(z))}),h.addEventListener("change",()=>{K=h.checked,localStorage.setItem("teslaMode",String(K)),te()}),w.addEventListener("change",()=>{T=w.checked,localStorage.setItem("multiplayerEnabled",String(T)),window.location.reload()}),I&&I.addEventListener("input",()=>{m=I.value.slice(0,12),localStorage.setItem("playerName",m)}));const g=document.querySelector(".version-string, #version, .version, #version-string");g&&(g.textContent=`Version: ${Ae} (tag: ${Ge}, ${Be}, ${De}, built: ${Re})`),te()});function te(){const o=document.getElementById("onscreen-controls"),i=document.getElementById("desktop-copyright"),n=ke();o&&(o.style.display=n?"flex":"none"),i&&(i.style.display=n?"none":"block")}function Je(){const o=document.getElementById("btn-left"),i=document.getElementById("btn-right"),n=document.getElementById("btn-jump");o&&i&&n&&(o.addEventListener("touchstart",e=>{e.preventDefault(),d.ArrowLeft=!0}),o.addEventListener("touchend",e=>{e.preventDefault(),d.ArrowLeft=!1}),i.addEventListener("touchstart",e=>{e.preventDefault(),d.ArrowRight=!0}),i.addEventListener("touchend",e=>{e.preventDefault(),d.ArrowRight=!1}),n.addEventListener("touchstart",e=>{e.preventDefault(),d.Space=!0}),n.addEventListener("touchend",e=>{e.preventDefault(),d.Space=!1}),o.addEventListener("mousedown",e=>{e.preventDefault(),d.ArrowLeft=!0}),o.addEventListener("mouseup",e=>{e.preventDefault(),d.ArrowLeft=!1}),i.addEventListener("mousedown",e=>{e.preventDefault(),d.ArrowRight=!0}),i.addEventListener("mouseup",e=>{e.preventDefault(),d.ArrowRight=!1}),n.addEventListener("mousedown",e=>{e.preventDefault(),d.Space=!0}),n.addEventListener("mouseup",e=>{e.preventDefault(),d.Space=!1}))}Je();te();let G=[],F=0;function se(){G=[];for(let o=0;o<60;o++){const i=Math.random()*Math.PI*2,n=4+Math.random()*3;G.push({x:c.width/2+(Math.random()-.5)*100,y:c.height/2-80+(Math.random()-.5)*40,vx:Math.cos(i)*n,vy:Math.sin(i)*n-2,color:`hsl(${Math.floor(Math.random()*360)}, 80%, 60%)`,size:8+Math.random()*8,life:60+Math.random()*40,angle:Math.random()*Math.PI*2,spin:(Math.random()-.5)*.2})}F=60}function Ue(){for(const o of G)o.x+=o.vx,o.y+=o.vy,o.vy+=.15,o.angle+=o.spin,o.life--;G=G.filter(o=>o.life>0&&o.y<c.height+40),F>0&&F--}function Oe(){for(const o of G)t.save(),t.translate(o.x,o.y),t.rotate(o.angle),t.fillStyle=o.color,t.fillRect(-o.size/2,-o.size/6,o.size,o.size/3),t.restore()}function $e(){if(L&&X&&k){const e=k,r=Math.max(c.width/e.width,c.height/e.height),s=e.width*r,f=e.height*r;let a=-u%s;a>0&&(a-=s);for(let h=a;h<c.width;h+=s)t.drawImage(e,h,0,s,f)}else if(C){const e=t.createLinearGradient(0,0,0,c.height);e.addColorStop(0,J[0]),e.addColorStop(1,J[1]),t.fillStyle=e,t.fillRect(0,0,c.width,c.height)}else if(E){const e=t.createLinearGradient(-u,0,D-u,c.height);e.addColorStop(0,U[0]),e.addColorStop(1,U[1]),t.fillStyle=e,t.fillRect(0,0,c.width,c.height)}else t.fillStyle="#87ceeb",t.fillRect(0,0,c.width,c.height);t.save(),t.translate(-u,0),t.fillStyle="#654321";for(const e of M)"isSlope"in e&&e.isSlope?(t.beginPath(),t.moveTo(e.x,e.y),t.lineTo(e.x+e.width,e.endY),t.lineTo(e.x+e.width,e.endY+e.height),t.lineTo(e.x,e.y+e.height),t.closePath(),t.fill()):t.fillRect(e.x,e.y,e.width,e.height);t.fillStyle="#888";for(const e of R)t.fillRect(e.x,e.y,e.width,e.height);t.fillStyle="#b5651d";for(const e of H)t.fillRect(e.x,e.y,e.width,e.height);for(const e of y)e.collected||(e.type==="coin"?(t.fillStyle="#0cf",t.beginPath(),t.arc(e.x+e.width/2,e.y+e.height/2,10,0,2*Math.PI),t.fill()):e.type==="heart"?(t.save(),t.translate(e.x+e.width/2,e.y+e.height/2),t.scale(1.2,1.2),t.beginPath(),t.moveTo(0,6),t.bezierCurveTo(0,0,-10,0,-10,6),t.bezierCurveTo(-10,12,0,16,0,20),t.bezierCurveTo(0,16,10,12,10,6),t.bezierCurveTo(10,0,0,0,0,6),t.closePath(),t.fillStyle="#e33",t.fill(),t.restore()):e.type==="doublejump"?(t.save(),t.translate(e.x+e.width/2,e.y+e.height/2),t.rotate(-.3),t.beginPath(),t.moveTo(0,0),t.quadraticCurveTo(10,-10,0,-20),t.quadraticCurveTo(-8,-10,0,0),t.closePath(),t.fillStyle="#fff",t.fill(),t.strokeStyle="#0cf",t.lineWidth=2,t.stroke(),t.restore()):e.type==="grow"&&(t.save(),t.translate(e.x+e.width/2,e.y+e.height/2),t.beginPath(),t.arc(0,0,10,Math.PI,2*Math.PI),t.lineTo(10,10),t.arc(0,10,10,0,Math.PI,!0),t.closePath(),t.fillStyle="#fff",t.fill(),t.beginPath(),t.arc(0,0,10,Math.PI,2*Math.PI),t.closePath(),t.fillStyle="#e33",t.fill(),t.restore()));t.fillStyle="#e33";for(const e of Y)t.beginPath(),t.moveTo(e.x,e.y+e.height),t.lineTo(e.x+e.width/2,e.y),t.lineTo(e.x+e.width,e.y+e.height),t.closePath(),t.fill();t.restore(),j>0&&Math.floor(j/5)%2===0?t.globalAlpha=.3:t.globalAlpha=1,t.fillStyle="#ff0",t.fillRect(l.x-u,l.y,l.width,l.height),t.globalAlpha=1,t.save(),t.fillStyle="#0cf";let o=S,i=[];for(const e of v.values())typeof e.score=="number"&&e.score>o?(o=e.score,i=[e.id]):typeof e.score=="number"&&e.score===o&&i.push(e.id);S===o&&i.push("self");for(const e of v.values())t.fillRect(e.x-u,e.y,e.width,e.height),T&&v.size>0&&e.name&&(t.save(),t.font="16px sans-serif",i.includes(e.id)?(t.fillStyle="gold",t.fillText("👑",e.x-u+e.width/2,e.y-22)):t.fillStyle="#fff",t.textAlign="center",t.fillText(e.name,e.x-u+e.width/2,e.y-8),t.restore());if(t.restore(),T&&v.size>0&&(t.save(),t.font="16px sans-serif",i.includes("self")?(t.fillStyle="gold",t.fillText("👑",l.x-u+l.width/2,l.y-22)):t.fillStyle="#fff",t.textAlign="center",t.fillText(m||"Player",l.x-u+l.width/2,l.y-8),t.restore()),t.save(),t.fillStyle="#fff",t.font="20px sans-serif",t.textAlign="left",t.fillText(`Score: ${S}`,20,30),t.fillText(`Top Score: ${_}`,20,60),t.fillText(`Level: ${oe}`,20,90),z&&t.fillText(`FPS: ${ge}`,20,120),P){t.fillStyle="#0cf";const e=z?150:120;t.fillText(`Speed: ${N}x`,20,e)}if(T&&v.size>0){const e=new Map;e.set(x.currentPlayerId,{id:x.currentPlayerId,name:m||"Player",score:S,isSelf:!0});for(const s of v.values())s.id!==x.currentPlayerId&&e.set(s.id,{id:s.id,name:s.name||"Player",score:typeof s.score=="number"?s.score:0,isSelf:!1});const r=Array.from(e.values());r.sort((s,f)=>f.score-s.score),t.save(),t.globalAlpha=.85,t.fillStyle="#222",t.fillRect(c.width-240,20,220,36+32*Math.min(5,r.length)),t.globalAlpha=1,t.font="18px sans-serif",t.fillStyle="#fff",t.textAlign="left",t.fillText("Leaderboard",c.width-225,44);for(let s=0;s<Math.min(5,r.length);s++){const f=r[s];t.font=f.isSelf?"bold 18px sans-serif":"18px sans-serif",t.fillStyle=f.isSelf?"#0cf":s===0?"gold":"#fff";const a=s===0?"👑 ":"";t.fillText(`${a}${f.name.slice(0,12)}`,c.width-225,76+s*32),t.textAlign="right",t.fillText(String(f.score),c.width-30,76+s*32),t.textAlign="left"}t.restore()}for(let e=0;e<B;e++)t.save(),t.translate(20+e*28,120),t.scale(1.2,1.2),t.beginPath(),t.moveTo(0,6),t.bezierCurveTo(0,0,-10,0,-10,6),t.bezierCurveTo(-10,12,0,16,0,20),t.bezierCurveTo(0,16,10,12,10,6),t.bezierCurveTo(10,0,0,0,0,6),t.closePath(),t.fillStyle="#e33",t.fill(),t.restore();let n=20+B*28+20;l.hasDoubleJump&&(t.save(),t.translate(n,120),t.rotate(-.3),t.beginPath(),t.moveTo(0,0),t.quadraticCurveTo(10,-10,0,-20),t.quadraticCurveTo(-8,-10,0,0),t.closePath(),t.fillStyle="#fff",t.fill(),t.strokeStyle="#0cf",t.lineWidth=2,t.stroke(),t.restore(),n+=36);for(let e=0;e<l.growLevel;e++)t.save(),t.translate(n,120),t.beginPath(),t.arc(0,0,10,Math.PI,2*Math.PI),t.lineTo(10,10),t.arc(0,10,10,0,Math.PI,!0),t.closePath(),t.fillStyle="#fff",t.fill(),t.beginPath(),t.arc(0,0,10,Math.PI,2*Math.PI),t.closePath(),t.fillStyle="#e33",t.fill(),t.restore(),n+=36;t.restore(),Q?(t.save(),t.fillStyle="rgba(0, 0, 0, 0.7)",t.fillRect(c.width/2-200,c.height/2-100,400,200),t.strokeStyle="#444",t.lineWidth=2,t.strokeRect(c.width/2-200,c.height/2-100,400,200),t.font="bold 48px sans-serif",t.fillStyle="#e33",t.textAlign="center",t.fillText("Game Over",c.width/2,c.height/2-60),t.font="32px sans-serif",t.fillStyle="#fff",t.fillText(`Score: ${S}`,c.width/2,c.height/2-10),t.fillText(`Top Score: ${_}`,c.width/2,c.height/2+40),S>Number(localStorage.getItem("topScore")||"0")&&(t.font="bold 28px sans-serif",t.fillStyle="#0cf",t.fillText("You beat your own top score!",c.width/2,c.height/2+90),F===0&&se()),t.restore(),ye()):Te(),t.save(),t.translate(-u,0),t.fillStyle="#fff",t.fillRect(p.x,p.y,8,p.height),t.beginPath(),t.moveTo(p.x+8,p.y),t.lineTo(p.x+8+32,p.y+16),t.lineTo(p.x+8,p.y+32),t.closePath(),t.fillStyle="#e33",t.fill(),t.restore(),Oe()}function we(){const o=performance.now(),i=o-ae;$e(),i>=1e3/Se&&(ce++,ce%60===0&&(ge=Math.round(1e3/(i/60))),Ce(i/1e3),Ue(),ae=o),requestAnimationFrame(we)}const d={};let de=!1,$=0;window.addEventListener("keydown",o=>{d[o.code]=!0});window.addEventListener("keyup",o=>{d[o.code]=!1});T?(async()=>{try{await x.initialize()?(console.log("Multiplayer enabled!"),x.onGameStateUpdate(i=>{v.clear(),i.players.forEach(n=>{n.id!==x.currentPlayerId?v.set(n.id,n):(n.name&&n.name!==m&&(m=n.name,localStorage.setItem("playerName",m),I&&(I.value=m)),typeof n.score=="number"&&(S=n.score))})}),x.onPlayerJoined(i=>{console.log(`Player ${i} joined the game!`)}),x.onPlayerLeft(i=>{console.log(`Player ${i} left the game`),v.delete(i)}),x.onPlayerUpdate((i,n,e,r)=>{if(v.has(i)){const s=v.get(i);Object.assign(s,n),typeof e=="number"&&(s.score=e),typeof r=="string"&&(s.name=r)}else v.set(i,{id:i,...n,score:e,name:r});i===x.currentPlayerId&&(typeof e=="number"&&(S=e),typeof r=="string"&&r!==m&&(m=r,localStorage.setItem("playerName",m),I&&(I.value=m)))})):console.log("Running in single-player mode")}catch{console.log("Multiplayer initialization failed, continuing in single-player mode")}})():console.log("Running in single-player mode");we();
